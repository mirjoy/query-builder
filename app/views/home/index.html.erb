<h1 class="text-center">AlchemyAPI News Finder</h1>

<div id="search-form">
  <h3>Search millions of news and blog articles</h3>
  <%= form_for(:home, url: home_index_path, method: :post) do |f| %>
    <div class="row col-sm-12">
      <div class="col-sm-2">
       <%= f.label "Where " %>
      </div>
      <div class="col-sm-3">
        <%= f.text_field :news_query %></p>
      </div>
    </div>
    <div class="row col-sm-12">
    <div class="col-sm-2">
      <p><%= f.label "Is mentioned as" %>
    </div>
   <!--  <%= f.select :entity, options_for_select(@entities.each { |ent| ent }, class: "dropdown") %> -->
   <div class="dropdown col-sm-3">
      <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        Select an Entity
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
        <% @entities.each do |entity| %>
        <li><a href="#"><%= entity %></a></li>
       <% end %>
      </ul>
    </div>
  </div>
  <div class="row col-sm-12" id="submit">
    <div class="col-sm-2">&nbsp;</div>
    <div class="col-sm-3">
      <%= f.submit "Submit", class: "btn btn-success" %>
    </div>
  </div>
</div>
<% end %>

<% if flash[:error] %>
  <div class="row col-sm-12">
    <div class="danger"><%= flash[:error] %></div>
  </div>
<% end %>

<div class="row col-sm-12">
<% if @stories && !@stories.empty? %>
  <% @stories.each_with_index do |story, index| %>
    <div class="story">
      <h3>Story #<%= index + 1 %>:
        <%= link_to story.title, story.url %></h3>

      <!-- <p>Excerpt: <%= story.excerpt %></p> -->
      <p>Keywords: <%= story.keywords %></p>
      <p>Sentiment: <%= story.sentiment %></p>
      <p>Taxonomy: <%= story.taxonomy %></p>

      <table class="table table-striped">
        <tr>
          <td class="entity-header">Entity</td>
          <td class="entity-header">Type</td>
          <td class="entity-header">Sentiment</td>
        </tr>
        <% story.entities.each do |ent| %>
          <tr class="entity">
            <td id="entity-title"><%= ent.title %></td>
            <td><%= ent.entity_type %></td>
            <td><%= ent.sentiment.capitalize %></td>
          </tr>
        <% end %>
      </table>
    </div>
  <% end %>
<% end %>
</div>
